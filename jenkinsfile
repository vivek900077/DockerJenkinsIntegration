pipeline {
    agent any
    environment {
        registry = "vivekreddy2000/vvv"
        registryCredential = 'dockerhub'
        registryImage = ''
    }
    stages {
        stage ('clone') {
            steps {
                git 'https://github.com/vivek900077/DockerJenkinsIntegration.git'
            }
        }
        stage ('compile') {
            steps {
                sh ''' mvn compile '''
            }
        }
        stage ('test') {
            steps {
                sh ''' mvn test '''
            }
        }
        stage ('package') {
            steps {
                sh ''' mvn package '''
            }
        }
        stage ('sonar') {
            steps {
                sh ''' mvn clean verify sonar:sonar -Dsonar.projectKey=saru -Dsonar.host.url=http://3.111.219.8:9000 -Dsonar.login=sqp_acf811dd4bbfce2b11a9b95b180c245cdfe6cb9f'''
            }
        }
        stage ('nexus') {
            steps {
                sh '''curl -v -u admin:admin123 --upload-file /var/lib/jenkins/workspace/sam/target/*.war http://3.111.219.8:8081/nexus/content/repositories/saru '''
            }
        }
        stage ('image ') {
            steps {
                script {
                    dockerImage = docker.build registry
                }
            }
        }
        stage ('push to hub') {
            steps {
                script {
                    docker.withRegistry ('', registryCredential) {
                        dockerImage.push ( )
                    }
                }
            }
        }
         stage('pull from hub') {
            steps { 
            sh ''' docker pull  vivekreddy2000/vvv:latest
             docker run --name jaw -d -p 8087:8080 vivekreddy2000/vvv:latest '''
            }
        }
    }
}    
         
